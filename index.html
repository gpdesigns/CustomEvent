<!DOCTYPE html>
<html lang ="en">
 <head>
   <meta charset = utf-8>
   <title>Custom Events</title>
   <!-- Add fancyBox -->
   <link rel="stylesheet" href="fancybox/source/jquery.fancybox.css" type="text/css" media="screen" />
   <style>
      body {width:1200px; margin:auto;text-align: center; font-size:21px}
      ul {list-style: none;}
      .images { float:left;}
      input[type=text] { border:1px solid #ccc; width:300px; padding:.25em; background:pink; color:white; font-size: 0.85em; text-align:center;}
   </style>

 </head>
<body>
<h1>What are you flickring</h1>
<form action="#">
 <input type="text" name="q" id="q">
</form>
<ul class="photos">
 

</ul>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script type="text/javascript" src="fancybox/source/jquery.fancybox.pack.js"></script>   

<script>
(function( $ ){
  var o = $( {} );
    $.each({
      trigger: 'publish',
      on: 'subscribe',
      off: 'unsubscribe'
    }, function(key, val){
    jQuery[val] = function(){
      o[key].apply( o, arguments );
    };
  });    
})(jQuery);

(function($){
  var Flickr = {

    init:function() {
      this.query = 'purple';
      this.photos = [];
      this.timer;

      this.cache();
      this.bindEvents();
      this.subscriptions();

      //default state
      this.searchInput.val( this.query );
      $.publish( 'flickr/query');

      return this; // return flickr object 
    },
    cache: function() {
      this.container = $('ul.photos');
      this.searchInput = $('#q');
    },
    bindEvents: function() {
      this.searchInput.on('keyup', this.search)
    },
    subscriptions: function() {
      $.subscribe( 'flickr/query', this.fetchJSON);
      $.subscribe( 'flickr/results', this.renderResults);
    },
    search: function() {
      var self = Flickr,
        input = this;
      clearTimeout( self.timer );

      self.timer = ( input.value.length >= 3 ) && setTimeout(function() {
        self.query = input.value;
        $.publish( 'flickr/query' );
      }, 400);
    },
    fetchJSON: function() {
        $.getJSON( 'https://api.flickr.com/services/rest/?method=flickr.photos.search&api_key=ded9c79e37b82de77c454f33132584bc&tags=' + Flickr.query + '&format=json&nojsoncallback=1', function( photo ){
          //console.log(photo);
          Flickr.photos = photo.photos;
          $.publish( 'flickr/results' );
        });
    },

    renderResults: function() {
      var self = Flickr,
      frag = [],
      photo;

      self.container.html(
        $.map( self.photos.photo, function( obj, index ){
          var farm = obj.farm;
          var server = obj.server;
          var photoid = obj.id;
          var secret = obj.secret;
          var title = obj.title;
          //koupaliště Rodina výlet
          var size = 'q';
          var full = 'b';
          var url = 'https://farm' + farm + '.staticflickr.com/' + server + '/' + photoid + '_' + secret + '_' + size + '.jpg';
          return '<li class="images"><a class="fancybox" rel="group" href="https://farm' + farm + '.staticflickr.com/' + server + '/' + photoid + '_' + secret + '_' + full + '.jpg" title="' + title +'"><img src="' + url + '"></li></a>';
            //return '<li>' + obj.title + '</li>';
        }).join('')
      );
    }
  };  
window.Flickr = Flickr.init();
})(jQuery);
$(document).ready(function() {
    $(".fancybox").fancybox();
  });
</script>
</body>
</html>    